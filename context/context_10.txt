Module 9 - Exercise
Image Inpainting Using DDPMs
Year 2023
AI VIET NAM
Nguyen Quoc Thai
AI VIETNAM
All-in-One Course
1
2
Objectives
Image Inpainting using Denoising Diffusion Probabilistic Model
!
3
Ã˜ Introduction
Ã˜ Denoising Diffusion Probabilistic Model
Ã˜ Image Inpainting using DDPM
Outline
4
Introduction
What is Image Inpainting?
!
Ã˜ Image Inpainting is to fill missing parts of image
Ã˜ Important Point: Fill in the hole with
Â§ Visually realistic
Â§ Semantically plausible
Image Inpainting
5
Introduction
Different Masking Techniques
!
Random Box Mak
Center Box Mask
Irregular Mask
Free-Form Mask
Hybrid Mask
6
Introduction
Two main approach
!
Ã˜ Patch Pasting
Â§ Search similar patches to hole-surrounding areas
Â§ PatchMatch, Scene Completion,â€¦
Ã˜ Deep Learning Methods
Â§ Learn how to fill the hole using large scale dataset
Â§ GLCIC, Gated Conv, Generative Models,â€¦
7
Introduction
PatchMatch
!
Ã˜ Search similar patch to the hole surrounding areas in an input image
Ã˜ Paste the searched patch to the hole
Ã˜ Loop
8
Introduction
PatchMatch
!
Initialization
Propagation
Search
9
Introduction
Scene Completion
!
Ã˜ Search the image similar to an input from large scale image database
Ã˜ Search similar patch and paste it to the inputâ€™s hole
Original Image
Input
Scene Matches
Output
10
Introduction
Deep Learning Methods
!
Ã˜ Generate the contents of the hole using CNNs from the large dataset
Ã˜ Encoder-Decoder CNN
11
Introduction
Deep Learning Methods
!
Ã˜ Global and Locally Consistent Image Completion
12
Introduction
Deep Learning Methods
!
Ã˜ Diffusion Models
13
Ã˜ Introduction
Ã˜ Denoising Diffusion Probabilistic Model
Ã˜ Image Inpainting using DDPM
Outline
14
DDPMs
Objectives
!
Ã˜ Destroy structure in a data distribution through an iterative forward diffusion process
15
DDPMs
Objectives
!
Ã˜ Destroy structure in a data distribution through an iterative forward diffusion process
Ã˜ Learn a reverse diffusion process that restores structure in data
Model
16
DDPMs
Objectives
!
Model
17
DDPMs
Forward Diffusion Process
!
ğ‘§~ ğ’©(0, 1)
Pure Noise
18
DDPMs
Forward Diffusion Process
!
Pure Noise
ğ‘§~ ğ’©(0, 1)
Regulated by a schedule 
ğ›½
x0
x100
x200
x300
T=300 (timestep)
19
DDPMs
Forward Diffusion Process
!
Ã˜ Linear Noise Schedule
ğ›½!"#$" = 0.0001
ğ›½%&' = 0.02
20
DDPMs
Forward Diffusion Process
!
Ã˜ Noise Schedule
21
DDPMs
Forward Diffusion Process
!
Ã˜ Noise Schedule
Linear Schedule
Cosine Schedule
22
DDPMs
Forward Diffusion Process
!
x()*
x(
q(x!|x!"#)
x+
x,
q(x! x!"# = ğ’©x!;
1 âˆ’Î²!x!"#, Î²!I
Normal distribution
Mean
Output
Variance
23
DDPMs
Forward Diffusion Process
!
x()*
x(
q(x!|x!"#)
x+
x,
q(x! x!"# = ğ’©x!;
1 âˆ’Î²!x!"#, Î²!I
=
1 âˆ’ğ›½$ğ‘¥$"# +
ğ›½$ğœ–
=
2ğ›¼$ğ‘¥% +
1 âˆ’2ğ›¼$ğœ–
ğ›¼$ = 1 âˆ’ğ›½$
2ğ›¼$ = 4
&'#
$
ğ‘&
ğ’©ğœ‡, Ïƒ( = ğœ‡+ ğœ9 ğœ–
24
DDPMs
Forward Diffusion Process
!
x()*
x(
q(x!|x!"#)
x+
x,
q(x! x!"# = ğ’©x!;
1 âˆ’Î²!x!"#, Î²!I
=
2ğ›¼$ğ‘¥% +
1 âˆ’2ğ›¼$ğœ–
ğ›¼$ = 1 âˆ’ğ›½$
2ğ›¼$ = 4
&'#
$
ğ‘&
ğ’©ğœ‡, Ïƒ( = ğœ‡+ ğœ9 ğœ–
q(x! x% = ğ’©x!;
2ğ›¼$ğ‘¥%,
1 âˆ’2ğ›¼$I
25
DDPMs
Reverse Diffusion Process
!
x()*
x(
q(x!"#|x!, x%)
x+
x,
26
DDPMs
Reverse Diffusion Process
!
x()*
x(
q(x!"#|x!, x%)
x+
x,
Unet Model
Unet Model
Unet Model
27
DDPMs
Reverse Diffusion Process
!
x()*
x(
q(x!"#|x!, x%)
x+
x,
Unet Model
Unet Model
Unet Model
Timestep Embedding
Timestep Embedding
Timestep Embedding
Sinusoidal 
Embedding
28
DDPMs
Reverse Diffusion Process
!
Ã˜ UNet Model with Self-Attention
29
DDPMs
Reverse Diffusion Process
!
Ã˜ UNet Model with Self-Attention
Ã˜ Adaptive Group Normalization
AdaGN(h, y = y)GroupNorm(h + y*)
Conv
GroupNorm
â€¦
y)
y)
+
âˆ—
30
DDPMs
Reverse Diffusion Process
!
ğª(ğ±ğ­"ğŸğ±ğ­, ğ±ğŸ= ğ“ğ±ğ­"ğŸ; Iğ›ğ±ğ­, ğ±ğŸ, Kğ›ƒğ­
0Âµ x(, x+ =
2Î±()*Î²(
1 âˆ’2Î±(
x+ +
Î±( 1 âˆ’2Î±()*
1 âˆ’2Î±(
x(
6Î²( = 1 âˆ’2Î±()*
1 âˆ’2Î±(
Î²(
31
DDPMs
Training
!
32
DDPMs
Sampling
!
33
Ã˜ Introduction
Ã˜ Denoising Diffusion Probabilistic Model
Ã˜ Image Inpainting using DDPM
Outline
34
Image Painting using DDPMs
CelebA Dataset
!
35
Image Painting using DDPMs
Center Box Mask
!
Masking
36
Image Painting using DDPMs
Approach
!
Model
37
Image Painting using DDPMs
Reverse Diffusion Model
!
x()*
x(
x+
x,
Unet Model
Unet Model
Unet Model
Timestep Embedding
Timestep Embedding
Timestep Embedding
Keep
38
Image Painting using DDPMs
Experiment
!
Inpainting
39
Summary
Thanks!
Any questions?
40
