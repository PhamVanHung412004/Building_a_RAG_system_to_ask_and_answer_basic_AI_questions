1
AI VIETNAM
All-in-One Course
1
Introduction to Diffusion Model
Vinh Dinh Nguyen
PhD in Computer Science
2
AI VIETNAM
All-in-One Course
2
Vinh Dinh Nguyen- PhD in Computer Science
Ø Objective
Ø Application of Diffusion Models
Ø Why Do We Need Diffusion Model?
Ø Diffusion Model Detail Explanation and Implementation
Ø Summary
Outline
3
AI VIETNAM
All-in-One Course
3
Vinh Dinh Nguyen- PhD in Computer Science
Ø Objective
Ø Application of Diffusion Models
Ø Why Do We Need Diffusion Model?
Ø Diffusion Model Detail Explanation and Implementation
Ø Summary
Outline
4
AI VIETNAM
All-in-One Course
4
Vinh Dinh Nguyen- PhD in Computer Science
Objective
1
• Understand a Diffusion Model
2
• Understand a Forward Diffusion Process
3
• Understand a Reverse Diffusion Process
4
• Be able to Implement a Diffusion Model Using Pytorch
5
AI VIETNAM
All-in-One Course
5
Vinh Dinh Nguyen- PhD in Computer Science
Ø Objective
Ø Application of Diffusion Models
Ø Why Do We Need Diffusion Model?
Ø Diffusion Model Detail Explanation and Implementation
Ø Summary
Outline
6
AI VIETNAM
All-in-One Course
6
Vinh Dinh Nguyen- PhD in Computer Science
Applications of Diffusion Model
Textual Inversion
Text To Videos
Text To 3D
Text To Motion
Image To Image
Image Inpainting
7
AI VIETNAM
All-in-One Course
7
Vinh Dinh Nguyen- PhD in Computer Science
AutoEncoder, Variational AutoEncoder, and, 
Generative Adversarial Network: Limitations
Illustration of a generative model based on noise input
Input
Network
Output
An example of artifacts in an image generated by GAN.
You can see the artifacts in the cat’s body and the
distortion of the background at the top of the image.
8
AI VIETNAM
All-in-One Course
8
Vinh Dinh Nguyen- PhD in Computer Science
AutoEncoder, Variational AutoEncoder, and, 
Generative Adversarial Network: Limitations
9
AI VIETNAM
All-in-One Course
9
Vinh Dinh Nguyen- PhD in Computer Science
GAN’s Main Idea: Review
The first key point lies in the idea that there exists a probability distribution describing the kind of data we try to generate. We want to be 
able to sample new data from that distribution 
Source: https://towardsdatascience.com/understanding-generative-adversarial-networks-gans-cd6e4651a29
10
AI VIETNAM
All-in-One Course
10
Vinh Dinh Nguyen- PhD in Computer Science
Source:
https://towardsdatascience.com/understanding-
generative-adversarial-networks-gans-cd6e4651a29
GAN 
Review
11
AI VIETNAM
All-in-One Course
11
Vinh Dinh Nguyen- PhD in Computer Science
VAE’s Main Idea: Review
Source: https://towardsdatascience.com/understanding-generative-adversarial-networks-gans-cd6e4651a29
Auto-Encoder
12
AI VIETNAM
All-in-One Course
12
Vinh Dinh Nguyen- PhD in Computer Science
VAE’s Main Idea: Review
Source: https://towardsdatascience.com/understanding-generative-adversarial-networks-gans-cd6e4651a29
Denoising 
Auto-Encoder
13
AI VIETNAM
All-in-One Course
13
Vinh Dinh Nguyen- PhD in Computer Science
VAE’s Main Idea: Review
Source: https://towardsdatascience.com/understanding-generative-adversarial-networks-gans-cd6e4651a29
Variational 
Autoencoder
14
AI VIETNAM
All-in-One Course
14
Vinh Dinh Nguyen- PhD in Computer Science
Ø Objective
Ø Application of Diffusion Models
Ø Why Do We Need Diffusion Models?
Ø Diffusion Model Detail Explanation and Implementation
Ø Summary
Outline
15
AI VIETNAM
All-in-One Course
15
Vinh Dinh Nguyen- PhD in Computer Science
Why diffusion model?
In non-equilibrium statistical physics, the diffusion process refers
to: “The movement of particles or molecules from an area of
high concentration to an area of low concentration, driven by a
gradient in concentration.”
Source: https://chem.libretexts.org/Under_Construction/Purgatory/Kinetic_Theory_of_Gases
16
AI VIETNAM
All-in-One Course
16
Vinh Dinh Nguyen- PhD in Computer Science
Why diffusion model?
Diffusion models use many steps to generate the final image. In each step, the model makes a
refinement of the result of the previous step. In this way, the model can gradually improve the
result, get a better image after each step, and also fix errors that are made along the way.
it could be very beneficial if we wouldn’t need to generate the image in one forward pass but
iteratively improve it step by step. In this way, even if the model makes some mistakes, it has
the opportunity to find and correct these mistakes in the later steps.
Diffusion Model
17
AI VIETNAM
All-in-One Course
17
Vinh Dinh Nguyen- PhD in Computer Science
What is a diffusion model?
The idea of the diffusion model is not that old. In the 2015 paper called “Deep Unsupervised Learning using Nonequilibrium Thermodynamics”, 
the Authors described it like this:
“The essential idea, inspired by non-equilibrium statistical physics, is to systematically and slowly destroy structure in a data
distribution through an iterative forward diffusion process. We then learn a reverse diffusion process that restores structure in
data, yielding a highly flexible and tractable generative model of the data”.
Forward diffusion process
Reverse diffusion process
Diffusion Model
18
AI VIETNAM
All-in-One Course
18
Vinh Dinh Nguyen- PhD in Computer Science
Ø Objective
Ø Application of Diffusion Models
Ø Why Do We Need Diffusion Model?
Ø Diffusion Model Detail Explanation and Implementation
Ø Summary
Outline
19
AI VIETNAM
All-in-One Course
19
Vinh Dinh Nguyen- PhD in Computer Science
Forward Diffusion Process
Input
Output
Some none-random distribution
Purse noise
Adding noise
βt refers to something called schedule and values can range from 0 to 1. The values are usually kept low to prevent variance from exploding
20
AI VIETNAM
All-in-One Course
20
Vinh Dinh Nguyen- PhD in Computer Science
Gaussian Distribution: Recall
21
AI VIETNAM
All-in-One Course
21
Vinh Dinh Nguyen- PhD in Computer Science
Gaussian Distribution: Recall
Moving the mean value shifts the distribution from right to left while changing sigma affects the shape of the distribution. As the value of sigma 
increases, the curve gets more and more flat. Let’s see that in action.
22
AI VIETNAM
All-in-One Course
22
Vinh Dinh Nguyen- PhD in Computer Science
Forward Diffusion Process
Time: t=0
Generate noise for current step t
Input
Add noise to using 
linear scheduler
Time: t=1
Add noise to using 
linear scheduler
Time: t=2
Time: t=n
Generate noise for current step t
Generate noise for current step t
Output
Why do we need the scaling factor (1−βt) to shift the mean?
23
AI VIETNAM
All-in-One Course
23
Vinh Dinh Nguyen- PhD in Computer Science
Forward Diffusion Process
Entire forward diffusion process using linear schedule with 1000 time steps
24
AI VIETNAM
All-in-One Course
24
Vinh Dinh Nguyen- PhD in Computer Science
Forward Diffusion Process
Entire forward diffusion process using Cosine schedule with 50 time steps
25
AI VIETNAM
All-in-One Course
25
Vinh Dinh Nguyen- PhD in Computer Science
Importance of Noise Scheduling for 
Diffusion Models
26
AI VIETNAM
All-in-One Course
26
Vinh Dinh Nguyen- PhD in Computer Science
Forward Diffussion Process: Theory
The training process doesn’t use examples in line with the forward process but rather it uses samples from 
arbitrary timestep t
Each training step we would need to iterate through t steps to generate 1 training sample
Entire noise to be added at T
Function composition
Normal distribution formula for t=1
The formula uses the result from the t=2 step
Mean is dependent on the previous step
27
AI VIETNAM
All-in-One Course
27
Vinh Dinh Nguyen- PhD in Computer Science
Forward Diffussion Process: Theory
Normal distribution formula for t=1
The formula uses the result from the t=2 step
Mean is dependent on the previous step
Mean is changing 
through the steps
Everything is great but that is not computable
Need to apply the reparameterization trick
28
AI VIETNAM
All-in-One Course
28
Vinh Dinh Nguyen- PhD in Computer Science
Forward Diffussion Process: Theory
Everything is great but that is not computable
Need to apply the reparameterization trick
We can calculate noise at any arbitrary step t
29
AI VIETNAM
All-in-One Course
29
Vinh Dinh Nguyen- PhD in Computer Science
Forward Diffussion Process: Theory
30
AI VIETNAM
All-in-One Course
30
Vinh Dinh Nguyen- PhD in Computer Science
Forward Diffussion Process: Implementation
Input
Output
Swiss roll dataset
Noise
31
AI VIETNAM
All-in-One Course
31
Vinh Dinh Nguyen- PhD in Computer Science
Forward Diffussion Process: Implementation
Create swiss roll dataset
32
AI VIETNAM
All-in-One Course
32
Vinh Dinh Nguyen- PhD in Computer Science
Forward Diffussion Process: Implementation
33
AI VIETNAM
All-in-One Course
33
Vinh Dinh Nguyen- PhD in Computer Science
Forward Diffussion Process: Kernel Trick
Input
Output
Swiss roll dataset
Noise
34
AI VIETNAM
All-in-One Course
34
Vinh Dinh Nguyen- PhD in Computer Science
Forward Diffussion Process: Implementation
35
AI VIETNAM
All-in-One Course
35
Vinh Dinh Nguyen- PhD in Computer Science
Forward Diffussion Process: Visualization
Results from the paper
https://arxiv.org/pdf/1503.03585.pdf
Our implementation result
36
AI VIETNAM
All-in-One Course
36
Vinh Dinh Nguyen- PhD in Computer Science
Reverse Diffussion Process
The goal of the reverse diffusion process is to convert pure noise into an image
GAN
Something similar to 
the generator network
So why not just use GANs?
37
AI VIETNAM
All-in-One Course
37
Vinh Dinh Nguyen- PhD in Computer Science
Reverse Diffusion Misconception
A neural network (called diffusion model for even more confusion)
is removing noise from an input image or predicting the noise to
be removed from an input (True or False?)
Diffusion model predicts the entire noise to be removed in a given timestep. This means that if we have timestep t=600 then our Diffusion 
model tries to predict the entire noise on which removal we should get to t=0, not t=599.
38
AI VIETNAM
All-in-One Course
38
Vinh Dinh Nguyen- PhD in Computer Science
Forward Diffusion Process: Review
Time: t=0
Generate noise for current step t
Input
Add noise to using 
linear scheduler
Time: t=1
Add noise to using 
linear scheduler
Time: t=2
Time: t=n
Generate noise for current step t
Generate noise for current step t
Output
39
AI VIETNAM
All-in-One Course
39
Vinh Dinh Nguyen- PhD in Computer Science
Reverse Diffusion Process: Theory
40
AI VIETNAM
All-in-One Course
40
Vinh Dinh Nguyen- PhD in Computer Science
Reverse Diffusion Process: Theory
It
is
noteworthy
that
the
reverse
conditional probability is tractable when
conditioned on X0
41
AI VIETNAM
All-in-One Course
41
Vinh Dinh Nguyen- PhD in Computer Science
Reverse Diffusion Process: Theory
42
AI VIETNAM
All-in-One Course
42
Vinh Dinh Nguyen- PhD in Computer Science
Reverse Diffusion Process: Theory
43
AI VIETNAM
All-in-One Course
43
Vinh Dinh Nguyen- PhD in Computer Science
Reverse Diffusion Process: Theory
44
AI VIETNAM
All-in-One Course
44
Vinh Dinh Nguyen- PhD in Computer Science
Reverse Diffusion Process: Implementation
45
AI VIETNAM
All-in-One Course
45
Vinh Dinh Nguyen- PhD in Computer Science
Reverse Diffusion Process: Implementation
46
AI VIETNAM
All-in-One Course
46
Vinh Dinh Nguyen- PhD in Computer Science
Reverse Diffusion Process: Implementation
47
AI VIETNAM
All-in-One Course
47
Vinh Dinh Nguyen- PhD in Computer Science
Local Network Deployment: Real Device 
Flask Rest API and Mobile
48
AI VIETNAM
All-in-One Course
48
Vinh Dinh Nguyen- PhD in Computer Science
Diffusion Model: Training Theory
Training amounts to maximizing the model log
The probability the generative model assigns to the data: 
this integral is intractable
Taking a cue from annealed importance sampling and the
Jarzynski equality
49
AI VIETNAM
All-in-One Course
49
Vinh Dinh Nguyen- PhD in Computer Science
Diffusion Model: Training Theory
Training amounts to maximizing the model log
Jensen’s inequality
50
AI VIETNAM
All-in-One Course
50
Vinh Dinh Nguyen- PhD in Computer Science
Reverse Diffusion Process: Theory
51
AI VIETNAM
All-in-One Course
51
Vinh Dinh Nguyen- PhD in Computer Science
Diffusion Model: Training Implementation
Epoch 1
Epoch 
5000
Epoch 
15000
Epoch 
30000
52
AI VIETNAM
All-in-One Course
52
Vinh Dinh Nguyen- PhD in Computer Science
Diffusion Model: Training Implementation
53
AI VIETNAM
All-in-One Course
53
Vinh Dinh Nguyen- PhD in Computer Science
Ø Objective
Ø Application of Diffusion Models
Ø Why Do We Need Diffusion Model?
Ø Diffusion Model Detail Explanation and Implementation
Ø Summary
Outline
54
AI VIETNAM
All-in-One Course
54
Vinh Dinh Nguyen- PhD in Computer Science
Summary
1
• How Does Diffusion Model Work
2
• How Does a Forward Diffusion Process Work
3
• How Does a Reverse Diffusion Process
4
• Be able to Implement a Diffusion Model Using Pytorch
55
AI VIETNAM
All-in-One Course
