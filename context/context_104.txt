Convolutional Neural Network
Year 2023
Quang-Vinh Dinh
Ph.D. in Computer Science
AI VIETNAM
All-in-One Course
Motivation and 
Introduction to CNN
â¢MLP Limitation
â¢From MLP to CNN
â¢Feature Map Down-sampling
â¢Some Examples
â¢Application to Cifar10
Outline
Fashion-MNIST dataset
T-shirt
Trouser
Pullover
Dress
Coat
Sandal
Shirt
Sneaker
Bag
Ankle
Boot
Grayscale images
Resolution=28x28
Training set: 60000 samples
Testing set: 10000 samples
MLP for Fashion-MNIST
AI VIETNAM
All-in-One Course
â– ReLU, He and Adam
784 Nodes
Input layer
Output
1
ğ‘§1
ğ‘§2
ğ‘§10
Softmax 
activation
Input
1
ReLU 
activation
256 Nodes
Hidden layer 1
Fully 
connect
Fully 
connect
10 Nodes
Output layer
â€¦
â€¦
â€¦
Case 1
2
MLP for Fashion-MNIST
AI VIETNAM
All-in-One Course
â– ReLU, He and Adam
Case 1
3
MLP for Fashion-MNIST
AI VIETNAM
All-in-One Course
â– ReLU, He and Adam
Case 1
Test Accuracy: ~89%
Adam with learning rate of 1e-4
Perform reasonably
4
Cifar-10 dataset
airplane
automobile
bird
cat
deer
dog
frog
horse
ship
truck
Color images
Resolution=32x32
Training set: 50000 samples
Testing set: 10000 samples
MLP for Cifar-10
AI VIETNAM
All-in-One Course
â– ReLU, He and Adam
3072 Nodes
Input layer
Output
1
ğ‘§1
ğ‘§2
ğ‘§10
Softmax 
activation
Input
1
ReLU 
activation
256 Nodes
Hidden layer 1
Fully 
connect
Fully 
connect
10 Nodes
Output layer
â€¦
â€¦
â€¦
Case 2
6
MLP for Cifar-10
AI VIETNAM
All-in-One Course
â– ReLU, He and Adam
Case 2
7
MLP for Cifar-10
AI VIETNAM
All-in-One Course
â– ReLU, He and Adam
Case 2
Perform disappointedly 
Test Accuracy: ~53%
8
MLP for Cifar-10
AI VIETNAM
All-in-One Course
â– ReLU, He and Adam: add more layers
3072 Nodes
Input layer
Output
1
ğ‘§1
ğ‘§2
ğ‘§10
Softmax 
activation
Input
1
ReLU 
activation
256 Nodes
Hidden layer 1
Fully 
connect
Fully 
connect
1
ReLU 
activation
256 Nodes
Hidden layer 2
Fully 
connect
10 Nodes
Output layer
â€¦
â€¦
â€¦
â€¦
Case 3
9
MLP for Cifar-10
AI VIETNAM
All-in-One Course
â– ReLU, He and Adam
Case 3
MLP for Cifar-10
AI VIETNAM
All-in-One Course
â– ReLU, He and Adam
Case 3
Still Perform poorly 
Test Accuracy: ~53%
11
MLP for Cifar-10
AI VIETNAM
All-in-One Course
â– ReLU, He and Adam
3072 Nodes
Input layer
Output
1
ğ‘§1
ğ‘§2
ğ‘§10
Softmax 
activation
Input
1
ReLU 
activation
256 Nodes
Hidden layer 1
Fully 
connect
Fully 
connect
1
ReLU 
activation
256 Nodes
Hidden layer 2
10 Nodes
Output layer
â€¦
â€¦
â€¦
â€¦
â€¦
Case 4
12
MLP for Cifar-10
AI VIETNAM
All-in-One Course
â– ReLU, He and Adam
Case 4
13
MLP for Cifar-10
AI VIETNAM
All-in-One Course
â– ReLU, He and Adam: Using 3 hidden layers
Case 4
Perform even worse 
Test Accuracy: ~52%
14
â¢MLP Limitation
â¢From MLP to CNN
â¢Feature Map Down-sampling
â¢Some Examples
â¢Application to Cifar10
Outline
From MLP to CNN
â– Multi-layer Perceptron
AI VIETNAM
All-in-One Course
28
28
784
1
. . .
. . .
Fully connect
activation
1
. . .
activation
Flatten data
Problem: Remove spatial information of the data
                Inefficiently have a large amount of parameters 
15
From MLP to CNN
â– Problem of flattening data
AI VIETNAM
All-in-One Course
ğ‘£1 ğ‘£2 ğ‘£3
ğ‘£4 ğ‘£5 ğ‘£6
ğ‘£7 ğ‘£8 ğ‘£9
Data
Spatial Information
ğ‘£1 
ğ‘£2 
ğ‘£3
ğ‘£4 
ğ‘£5 
ğ‘£6
ğ‘£7 
ğ‘£8 
ğ‘£9
ğ‘£1
ğ‘£2
ğ‘£3
ğ‘£4
ğ‘£5
ğ‘£6
ğ‘£7
ğ‘£8
ğ‘£9
Flattened Data
ğ‘£1
ğ‘£2
ğ‘£3
ğ‘£4
ğ‘£5
ğ‘£6
ğ‘£7
ğ‘£8
ğ‘£9
Remove spatial information of the data
16
From MLP to CNN
AI VIETNAM
All-in-One Course
ğ‘£1 
ğ‘£2 
ğ‘£3
ğ‘£4 
ğ‘£5 
ğ‘£6
ğ‘£7 
ğ‘£8 
ğ‘£9
ğ‘š1
ğ‘š2
ğ‘š3
ğ‘š4
1
1
ğ‘£1
ğ‘£2
ğ‘£3
ğ‘£4
ğ‘£5
ğ‘£6
ğ‘£7
ğ‘£8
ğ‘£9
ğ‘§1
1
ğ‘¤1
ğ‘¤2
ğ‘¤3
ğ‘¤4
ğ‘¤5
ğ‘¤6
ğ‘¤7
ğ‘¤8
ğ‘¤9
ğ‘
MLP
10 parameters
ğ‘š1
ğ‘š2
ğ‘š3
ğ‘š4
Feature Map
ğ‘¤1
ğ‘¤2
ğ‘¤3
ğ‘¤4
ğ‘
ğ‘£1 
ğ‘£2 
ğ‘£3
ğ‘£4 
ğ‘£5 
ğ‘£6
ğ‘£7 
ğ‘£8 
ğ‘£9
*
Convolution (=Correlation)
ğ‘¤1
ğ‘¤2
ğ‘¤3
ğ‘¤4
ğ‘
Kernel of parameters
CNN
5 parameters
ğ‘š1 = ğ‘£1ğ‘¤1 + ğ‘£2ğ‘¤2 + ğ‘£4ğ‘¤3 + ğ‘£5ğ‘¤4 + ğ‘
17
From MLP to CNN
AI VIETNAM
All-in-One Course
ğ‘š11
ğ‘š12
ğ‘š13
ğ‘š14
ğ‘¤11
ğ‘¤12
ğ‘¤13
ğ‘¤14
ğ‘1
ğ‘£1 
ğ‘£2 
ğ‘£3
ğ‘£4 
ğ‘£5 
ğ‘£6
ğ‘£7 
ğ‘£8 
ğ‘£9
*
Feature Map 1
CNN
10 parameters
ğ‘š21
ğ‘š22
ğ‘š23
ğ‘š24
ğ‘¤21 ğ‘¤22
ğ‘¤23
ğ‘¤24
ğ‘2
*
Feature Map 2
Kernel 1
Kernel 2
Kernel 1  â‰  Kernel 2
ğ‘£1
ğ‘£2
ğ‘£3
ğ‘£4
ğ‘£5
ğ‘£6
ğ‘£7
ğ‘£8
ğ‘£9
ğ‘§1
1
MLP
20 parameters
ğ‘§2
18
Global vs. Local?
Parameter size?
From MLP to CNN
â– Understand convolution
AI VIETNAM
All-in-One Course
ğ‘¤1
ğ‘¤2
ğ‘¤3
ğ‘¤4
ğ‘
ğ‘£1 
ğ‘£2 
ğ‘£3
ğ‘£4 
ğ‘£5 
ğ‘£6
ğ‘£7 
ğ‘£8 
ğ‘£9
*
(Channel=1, Height=3, Width=3)
Shape=(1,3,3)
Shape=(1,2,2)
#parameters (+bias) = 5
#channels of data     =     #channels of kernel
must
19
Convolution
â– How many cases?
0
0
1
2
2
1
2
2
1
2
0
2
0
2
1
0
1
1
1
0
1
0
0
0
1
Data D
0.0 0.1 -0.1
0.0 0.1
-0.2
0.0 0.1
0.0
Kernel K
Bias b = 0.0
0
0
1
2
2
1
2
2
1
2
0
2
0
2
1
0
1
1
1
0
1
0
0
0
1
0
0
1
2
2
1
2
2
1
2
0
2
0
2
1
0
1
1
1
0
1
0
0
0
1
0
0
1
2
2
1
2
2
1
2
0
2
0
2
1
0
1
1
1
0
1
0
0
0
1
0
0
1
2
2
1
2
2
1
2
0
2
0
2
1
0
1
1
1
0
1
0
0
0
1
0
0
1
2
2
1
2
2
1
2
0
2
0
2
1
0
1
1
1
0
1
0
0
0
1
0
0
1
2
2
1
2
2
1
2
0
2
0
2
1
0
1
1
1
0
1
0
0
0
1
0
0
1
2
2
1
2
2
1
2
0
2
0
2
1
0
1
1
1
0
1
0
0
0
1
0
0
1
2
2
1
2
2
1
2
0
2
0
2
1
0
1
1
1
0
1
0
0
0
1
0
0
1
2
2
1
2
2
1
2
0
2
0
2
1
0
1
1
1
0
1
0
0
0
1
20
Convolution
â– Example
AI VIETNAM
All-in-One Course
0
0
1
2
2
1
2
2
1
2
0
2
0
2
1
0
1
1
1
0
1
0
0
0
1
Data D
0.0 0.1 -0.1
0.0 0.1
-0.2
0.0 0.1
0.0
Kernel K
Output
Bias b = 0.0
ğ‘š1
ğ‘š1 = âˆ’0.1
ğ‘š1 = 0Ã—0.0 + 0Ã—0.1 + 1Ã—âˆ’0.1 +
1Ã—âˆ’0.2 + 2Ã—0.0 + 2Ã—0.1 +
0Ã—0.0 + 2Ã—0.0 + 0Ã—0.1
Data size = 5Ã—5
Kernel size = 3Ã—3
Stride = 1
21
Convolution
â– Example
AI VIETNAM
All-in-One Course
0
0
1
2
2
1
2
2
1
2
0
2
0
2
1
0
1
1
1
0
1
0
0
0
1
Data D
0.0 0.1 -0.1
0.0 0.1
-0.2
0.0 0.1
0.0
Kernel K
-0.1 -0.1 -0.2
-0.2 0.1
0.3
-0.3 0.1
0.3
Output
Bias b = 0.0
Data size = 5Ã—5
Kernel size = 3Ã—3
Stride = 1
ğ‘†ğ‘œ= ğ‘†ğ·âˆ’ğ¾
ğ‘†
+ 1
22
Convolution
â– Example
AI VIETNAM
All-in-One Course
0
0
1
2
2
1
2
2
1
2
0
2
0
2
1
0
1
1
1
0
1
0
0
0
1
Data D
0.0 0.1 -0.1
0.0 0.1
-0.2
0.0 0.1
0.0
Kernel K
Bias b = 0.0
ğ‘š1 = âˆ’0.1
Output
ğ‘š1
ğ‘š1 = 0Ã—0.0 + 0Ã—0.1 + 1Ã—âˆ’0.1 +
1Ã—âˆ’0.2 + 2Ã—0.0 + 2Ã—0.1 +
0Ã—0.0 + 2Ã—0.0 + 0Ã—0.1
Data size = 5Ã—5
Kernel size = 3Ã—3
Stride = 2
23
Convolution
â– Example
AI VIETNAM
All-in-One Course
0
0
1
2
2
1
2
2
1
2
0
2
0
2
1
0
1
1
1
0
1
0
0
0
1
Data D
0.0 0.1 -0.1
0.0 0.1
-0.2
0.0 0.1
0.0
Kernel K
-0.1 -0.2
0.1
0.3
Output
Bias b = 0.0
Data size = 5Ã—5
Kernel size = 3Ã—3
Stride = 2
24
ğ‘†ğ‘œ= ğ‘†ğ·âˆ’ğ¾
ğ‘†
+ 1
Convolutional Neural Network
â– Understand convolution
AI VIETNAM
All-in-One Course
Input Data
(3,32,32)
Convolve with 
1 kernel (3,5,5)
Feature map
(1,28,28)
Input Data
(3,32,32)
Convolve with 
4 kernels (3,5,5)
Feature maps
(4,28,28)
25
Convolutional Neural Network
â– A stack of convolutions
AI VIETNAM
All-in-One Course
Input Data
(3,32,32)
Convolve with 
4 kernels (3,5,5)
Feature maps
(4,28,28)
Convolve with 
5 kernels (4,7,7)
Feature maps
(5,22,22)
Convolve with 
6 kernels (5,5,5)
Feature maps
(6,18,18)
26
Convolutional Neural Network
â– A stack of pairs of convolution+activation
AI VIETNAM
All-in-One Course
Input Data
(3,32,32)
Convolve with 
4 kernels (3,5,5)
Feature maps
(4,28,28)
Convolve with 
5 kernels (4,7,7)
Feature maps
(5,22,22)
Convolve with 
6 kernels (5,5,5)
Feature maps
(6,18,18)
+activation
+activation
+activation
27
Convolutional Neural Network
â– Convolution layer in PyTorch
AI VIETNAM
All-in-One Course
nn.Conv2d(in_channels, out_channels, kernel_size)
Input Data
(1,32,32)
Convolve with 
4 kernels (1,5,5)
Feature maps
(4,28,28)
Input Data
(3,32,32)
Convolve with 
4 kernels (3,5,5)
Feature maps
(4,28,28)
28
Convolutional Neural Network
â– Convolution layer in PyTorch
AI VIETNAM
All-in-One Course
nn.Conv2d(in_channels, out_channels, kernel_size)
nn.ReLU()
Input Data
(1,32,32)
Feature map
(1,28,28)
Convolve with 
1 kernel (1,5,5)
+activation
Input Data
(3,32,32)
Feature map
(1,28,28)
Convolve with 
1 kernel (3,5,5)
+activation
demo
29
Fashion-MNIST dataset
T-shirt
Trouser
Pullover
Dress
Coat
Sandal
Shirt
Sneaker
Bag
Ankle
Boot
Convolutional 
Neural Network
Grayscale images
Resolution=28x28
Training set: 60000 samples
Testing set: 10000 samples
Convolutional Neural Network
â– Apply for Fashion-MNIST dataset
AI VIETNAM
All-in-One Course
(1,28,28)
(32,22,22)
(64,16,16)
(128,10,10)
(256,4,4)
Flatten data
10 nodes
4096 nodes
31
Convolutional Neural Network
â– Apply for Fashion-MNIST dataset
AI VIETNAM
All-in-One Course
(1,28,28)
(32,22,22)
(64,16,16)
(128,10,10)
(256,4,4)
10 nodes
4096 nodes
32 different 
kernels (7x7)
64 different 
kernels (7x7)
128 different 
kernels (7x7)
Flatten data
256 different 
kernels (7x7)
32
demo
Simple Convolutional Neural Network
Convolutional Neural Network
â– Apply for Cifar-10 dataset
AI VIETNAM
All-in-One Course
(3,32,32)
(?,?,?)
(?,?,?)
(?,?,?)
(?,?,?)
10 nodes
? nodes
32 different 
kernels (7x7)
64 different 
kernels (7x7)
128 different 
kernels (7x7)
Flatten data
256 different 
kernels (7x7)
demo
34
â¢MLP Limitation
â¢From MLP to CNN
â¢Feature Map Down-sampling
â¢Some Examples
â¢Application to Cifar10
Outline
Convolutional Neural Network
â– Apply for Fashion-MNIST dataset: case 1
AI VIETNAM
All-in-One Course
(1,28,28)
(32,22,22)
(64,16,16)
(128,10,10)
(256,4,4)
10 nodes
4096 nodes
32 different 
kernels (7x7)
64 different 
kernels (7x7)
128 different 
kernels (7x7)
Flatten data
256 different 
kernels (7x7)
128 nodes
35
Convolutional Neural Network
â– Apply for Fashion-MNIST dataset: case 1
AI VIETNAM
All-in-One Course
37
Test Accuracy: ~88%
Convolutional Neural Network
â– Apply for Cifar-10 dataset: case 2
AI VIETNAM
All-in-One Course
(3,32,32)
(32,26,26)
(64,20,20)
(128,14,14)
(256,8,8)
10 nodes
8*8*256 nodes
32 different 
kernels (7x7)
64 different 
kernels (7x7)
128 different 
kernels (7x7)
Flatten data
256 different 
kernels (7x7)
128 nodes
38
Convolutional Neural Network
â– Apply for Cifar-10 dataset: case 2
AI VIETNAM
All-in-One Course
40
Test Accuracy: ~69%
Test Accuracy from MLP: ~53%
Further Reading
AI VIETNAM
All-in-One Course
â– Reading
https://cs231n.github.io/convolutional-networks/
https://towardsdatascience.com/a-comprehensive-guide-to-convolutional-neural-networks-
the-eli5-way-3bd2b1164a53
https://stanford.edu/~shervine/teaching/cs-230/cheatsheet-convolutional-neural-networks
41
